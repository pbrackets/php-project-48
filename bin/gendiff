#!/usr/bin/env php
<?php
require_once __DIR__.'/../vendor/autoload.php';


$autoloadPath1 = __DIR__.'/../../../autoload.php';
$autoloadPath2 = __DIR__.'/../vendor/autoload.php';

if (file_exists($autoloadPath1)) {
    require_once $autoloadPath1;
} else {
    require_once $autoloadPath2;
}

$doc = <<<DOC
Generate diff

Usage:
    gendiff (-h|--help)
    gendiff (-v|--version)
    gendiff [--format <fmt>] <firstFile> <secondFile>
Options:
    -h --help         Show this screen
    -v --version      Show version
    --format <fmt>    Report format [default: stylish]

DOC;

// проверяем существование файлов и записываем в переменные абсолютные пути до файлов
$args   = Docopt::handle($doc);
$format = $args['--format'];

$firstFileName  = realpath($args["<firstFile>"]);
$secondFileName = realpath($args["<secondFile>"]);

if (!file_exists($firstFileName) || !file_exists($secondFileName)) {
    echo "Неверные пути до файлов\n";
}
//прочитать содержимое файлов в переменные
$firstFileContent  = file_get_contents($firstFileName);
$secondFileContent = file_get_contents($secondFileName);

//преобразовать содержимое файлов в массив и присвоить в переменные
$firstArray  = json_decode($firstFileContent, true);
$secondArray = json_decode($secondFileContent, true);
//var_dump($firstArray);
//var_dump($secondArray);
$result = [];
foreach ($firstArray as $key => $value) {
    if (array_key_exists($key, $secondArray)) {
        if ($value === $secondArray[$key]) {
            $result ['  '.$key] = $value;
        } else {
            $result ['- '.$key] = $value;
            $result ['+ '.$key] = $secondArray[$key];
        }
    } else {
        $result ['- '.$key] = $value;
    }
}

foreach ($secondArray as $skey => $svalue) {
    if (!array_key_exists($skey, $firstArray)) {
        $result ['+ '.$skey] = $svalue;
    }
}
function cmt($a, $b){
    $a = trim($a, '+ -');
    $b = trim($b, '+ -');
    if ($a == $b) { // если 2 значения массива равны
        return 0; // вернем 0
    }
    return ($a < $b) ? -1 : 1;
}
//сортировка по ключам
uksort($result, "cmt");
foreach ($result as $key => $value) {
    if (is_bool($value) && $value === true) {
        echo "$key: true\n";
    } elseif (is_bool($value) && $value === false) {
        echo "$key: false\n";
    } else {
        echo "$key: $value\n";
    }
}

//$res = json_encode($result);
//$trimmed = trim("- timeout", '+ -');
// $res = json_encode($result);
// var_dump($res);
// return $res;
//var_dump($trimmed);

//return $result;